<h1 id="tests-specification-for-oscore-group-communication">Tests Specification for OSCORE Group Communication</h1>
<h2 id="table-of-contents">Table of Contents</h2>
<ol type="1">
<li><a href="#notes">Notes</a></li>
<li><a href="#security-contexts-and-resources">Security Contexts and Resources</a>
<ol type="1">
<li><a href="#client-sec">Security Context A: Client</a></li>
<li><a href="#server-sec">Security Context B: Server</a></li>
<li><a href="#server-sec-C">Security Context C: Server</a></li>
<li><a href="#resources">Resources</a></li>
</ol></li>
<li><a href="#env-setup">Set up the environment</a>
<ol type="1">
<li><a href="#test-0a">Test 0a</a></li>
<li><a href="#test-0b">Test 0b</a></li>
</ol></li>
<li><a href="#correct-oscore-use">Correct OSCORE use</a>
<ol type="1">
<li><a href="#client">test</a>
<ol type="1">
<li><a href="#test-1a">Test 1a</a></li>
<li><a href="#test-1b">Test 1b</a></li>
<li><a href="#test-2a">Test 2a</a></li>
<li><a href="#test-2b">Test 2b</a></li>
</ol></li>
</ol></li>
</ol>
<h2 id="notes">1. Notes</h2>
<p>CoAP Version is 1 in all the tests.</p>
<p>The client and server may optionally display external_aad and COSE object (before and after compression) to simplify debugging.</p>
<p>It is recommended to have tested OSCORE functionalities (see TBD link) before running these tests.</p>
<p>Note that Group Communication (TBD link) mandates the use of NON for requests. This specification recommends the use of NON for responses as well.</p>
<p>Note that the CoAP Token timeout needs to be configured to run the tests with multiple responses (see TBD). This specification recommends using a timeout of appr. 30 seconds.</p>
<p>Most of the tests can be run between 2 nodes. A few tests require 3/4 nodes.</p>
<p>Although these specifications test the implementation of group OSCORE, this version does not rely on multicast communication. The test specified below can in fact be run on unicast between the nodes, to test the group OSCORE implementation features.</p>
<h2 id="configuration-security-contexts-and-resources">2. Configuration, Security Contexts and Resources</h2>
<h3 id="client-sec">Security Context A: Client</h3>
<ul>
<li>Common Context:
<ul>
<li>Master Secret: 0x0102030405060708090a0b0c0d0e0f10 (16 bytes)</li>
<li>Master Salt: 0x9e7ca92223786340 (8 bytes)</li>
<li>Common IV: 0x0x2ca58fb85ff1b81c0b7181b85e (13 bytes)</li>
<li>ID Context: 0x37cbf3210017a2d3 (8 bytes)</li>
</ul></li>
<li>Sender Context:
<ul>
<li>Sender ID: 0x (0 byte)</li>
<li>Sender Key: 0xaf2a1300a5e95788b356336eeecd2b92 (16 bytes)</li>
<li>Sender Seq Number: 00</li>
<li>Sender IV: 0x2ca58fb85ff1b81c0b7181b85e (using Partial IV: 00)</li>
<li>Private Key TBD</li>
</ul></li>
<li>Recipient Context 1:
<ul>
<li>Recipient ID: 0x01 (1 byte)</li>
<li>Recipient Key: 0xe39a0c7c77b43f03b4b39ab9a268699f (16 bytes)</li>
<li>Recipient IV: 0x2da58fb85ff1b81d0b7181b85e (using Partial IV: 00)</li>
<li>Public Key TBD</li>
</ul></li>
<li>Recipient Context 2:
<ul>
<li>Recipient ID: 0x02 (1 byte)</li>
<li>Recipient Key: TODO (16 bytes)</li>
<li>Recipient IV: TODO (using Partial IV: TODO)</li>
<li>Public Key TBD</li>
</ul></li>
</ul>
<h3 id="server-sec">Security Context B: Server</h3>
<ul>
<li>Common Context:
<ul>
<li>Master Secret: 0x0102030405060708090a0b0c0d0e0f10 (16 bytes)</li>
<li>Master Salt: 0x9e7ca92223786340 (8 bytes)</li>
<li>Common IV: 0x2ca58fb85ff1b81c0b7181b85e (13 bytes)</li>
<li>ID Context: 0x37cbf3210017a2d3 (8 bytes)</li>
</ul></li>
<li>Sender Context:
<ul>
<li>Sender Id: 0x01 (1 byte)</li>
<li>Sender Key: 0xe39a0c7c77b43f03b4b39ab9a268699f (16 bytes)</li>
<li>Sender Seq Number: 00</li>
<li>Sender IV: 0x2da58fb85ff1b81d0b7181b85e (using Partial IV: 00)</li>
<li>Private Key TBD</li>
</ul></li>
<li>Recipient Context:
<ul>
<li>Recipient Id: 0x (0 byte)</li>
<li>Recipient Key: 0xaf2a1300a5e95788b356336eeecd2b92 (16 bytes)</li>
<li>Recipient IV: 0x2ca58fb85ff1b81c0b7181b85e (using Partial IV: 00)</li>
<li>Public Key TBD</li>
</ul></li>
</ul>
<h3 id="server-sec-C">Security Context C: Server</h3>
<ul>
<li>Common Context:
<ul>
<li>Master Secret: 0x0102030405060708090a0b0c0d0e0f10 (16 bytes)</li>
<li>Master Salt: 0x9e7ca92223786340 (8 bytes)</li>
<li>Common IV: 0x2ca58fb85ff1b81c0b7181b85e (13 bytes)</li>
<li>ID Context: 0x37cbf3210017a2d3 (8 bytes)</li>
</ul></li>
<li>Sender Context:
<ul>
<li>Sender Id: 0x03 (1 byte)</li>
<li>Sender Key: TBD (16 bytes)</li>
<li>Sender Seq Number: 00</li>
<li>Sender IV: TBD (using Partial IV: 00)</li>
<li>Private Key TBD</li>
</ul></li>
<li>Recipient Context:
<ul>
<li>Recipient Id: 0x (0 byte)</li>
<li>Recipient Key: 0xaf2a1300a5e95788b356336eeecd2b92 (16 bytes)</li>
<li>Recipient IV: 0x2ca58fb85ff1b81c0b7181b85e (using Partial IV: 00)</li>
<li>Public Key TBD</li>
</ul></li>
</ul>
<h3 id="resources">Resources</h3>
<p>The list of resources the OSCORE-aware server must implement is the following:</p>
<ul>
<li>/oscore/hello/coap : authorized method: GET, returns the string “Hello World!” with content-format 0 (text/plain)</li>
<li>/oscore/hello/1 : protected resource, authorized method: GET, returns the string “Hello World!” with content-format 0 (text/plain)</li>
</ul>
<hr />
<h2 id="env-setup">3. Set up the environment</h2>
<h3 id="test-0a">3.1. Identifier: TEST_0a</h3>
<p><strong>Objective</strong> : Verify that CoAP exchange works. Perform a simple GET transaction using COAP, Content-Format and Uri-Path option (Client side)</p>
<p><strong>Test Sequence</strong></p>
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 14%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Stimulus</td>
<td><p>The client is requested to send a CoAP GET request including:</p>
<ul>
<li>Uri-Path : /oscore/hello/coap</li>
</ul></td>
</tr>
<tr class="even">
<td>2</td>
<td>Check</td>
<td>Client serializes the request</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Verify</td>
<td>Client displays the sent packet</td>
</tr>
<tr class="even">
<td>4</td>
<td>Check</td>
<td><p>Client parses the response and continues the CoAP processing expected; expected: 2.05 Content Response with:</p>
<ul>
<li>Content-Format = 0 (text/plain)</li>
<li>Payload = “Hello World!”</li>
</ul></td>
</tr>
<tr class="odd">
<td>5</td>
<td>Verify</td>
<td>Client displays the received packet</td>
</tr>
</tbody>
</table>
<h4 id="test-0b">3.2. Identifier: TEST_0b</h4>
<p><strong>Objective</strong> : Verify that CoAP exchange works. Perform a simple GET transaction using COAP, Content-Format and Uri-Path option (Server side)</p>
<p><strong>Configuration</strong> :</p>
<p><em>server resources</em>:</p>
<ul>
<li>/oscore/hello/coap : authorized method: GET, returns the string “Hello World!” with content-format 0 (text/plain)</li>
</ul>
<p><strong>Test Sequence</strong></p>
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 14%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Stimulus</td>
<td><p>The client is requested to send a CoAP GET request including:</p>
<ul>
<li>Uri-Path = /oscore/hello/coap</li>
</ul></td>
</tr>
<tr class="even">
<td>2</td>
<td>Check</td>
<td>Server parses the request and continues the CoAP processing</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Verify</td>
<td>Server displays the received packet</td>
</tr>
<tr class="even">
<td>4</td>
<td>Check</td>
<td><p>Server serialize the response correctly, which is: 2.05 Content Response with:</p>
<ul>
<li>Content-Format = 0 (text/plain)</li>
<li>Payload = “Hello World!”</li>
</ul></td>
</tr>
<tr class="odd">
<td>5</td>
<td>Verify</td>
<td>Server displays the sent packet</td>
</tr>
</tbody>
</table>
<h2 id="correct-group-oscore-use">4. Correct Group OSCORE Use</h2>
<h3 id="client">4.1 Several Recipient Contexts on Client</h3>
<p>In these tests, the client has several recipient contexts. The goal is to test the retrieval/derivation of recipient contexts on the client.</p>
<h4 id="test-1a">4.1.1. Identifier: TEST_1a</h4>
<p><strong>Objective</strong> : Perform an OSCORE Group transaction, where the client retrieve a recipient context that it has stored in memory. (Client side)</p>
<p><strong>Configuration</strong> :</p>
<p><em>client security context</em>: <a href="#client-sec">Security Context A</a>, with:</p>
<ul>
<li>Sequence number received not in client’s replay window</li>
</ul>
<p><strong>Test Sequence</strong></p>
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 14%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Stimulus</td>
<td><p>The client is requested to send a CoAP GET request protected with OSCORE, including:</p>
<ul>
<li>Object-Security option</li>
<li>Uri-Path : /oscore/hello/1</li>
</ul></td>
</tr>
<tr class="even">
<td>2</td>
<td>Check</td>
<td><p>Client serializes the request, which is a POST request, with:</p>
<ul>
<li>Object-Security option</li>
<li>Payload: ciphertext including: * Code: GET * Uri-Path : /oscore/hello/1</li>
</ul></td>
</tr>
<tr class="odd">
<td>3</td>
<td>Verify</td>
<td>Client displays the sent packet</td>
</tr>
<tr class="even">
<td>4</td>
<td>Check</td>
<td><p>Client parses the response; expected: 2.04 Changed Response with:</p>
<ul>
<li>Object-Security option: kid = 0x01</li>
<li>Payload</li>
</ul></td>
</tr>
<tr class="odd">
<td>4</td>
<td>Verify  </td>
<td>Client successfully retrieve correct Recipient Context and decrypts the message: OSCORE verification succeeds</td>
</tr>
<tr class="even">
<td>6</td>
<td>Check</td>
<td><p>Client parses the decrypted response and continues the CoAP processing; expected 2.05 Content Response with:</p>
<ul>
<li>Content-Format = 0 (text/plain)</li>
<li>Payload = “Hello World!”</li>
</ul></td>
</tr>
<tr class="odd">
<td>7</td>
<td>Verify</td>
<td>Client displays the received packet</td>
</tr>
</tbody>
</table>
<h4 id="test-1b">4.1.2. Identifier: TEST_1b</h4>
<p><strong>Objective</strong> : Perform an OSCORE Group transaction, where the client retrieve a recipient context that it has stored in memory. (Server side)</p>
<p><strong>Configuration</strong> :</p>
<p><em>server security context</em>: <a href="#server-sec">Security Context B</a>, with:</p>
<ul>
<li>Sequence number received not in server’s replay window</li>
</ul>
<p><em>server resources</em>:</p>
<ul>
<li>/oscore/hello/1 : protected resource, authorized method: GET, returns the string “Hello World!” with content-format 0 (text/plain)</li>
</ul>
<p><strong>Test Sequence</strong></p>
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 14%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Stimulus</td>
<td><p>The client is requested to send a CoAP GET request protected with OSCORE, including:</p>
<ul>
<li>Object-Security option</li>
<li>Uri-Path = /oscore/hello/1</li>
</ul></td>
</tr>
<tr class="even">
<td>2</td>
<td>Verify</td>
<td>Server displays the received packet</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Check</td>
<td><p>Server parses the request; expected: 0.02 POST with:</p>
<ul>
<li>Object-Security option</li>
<li>Payload</li>
</ul></td>
</tr>
<tr class="even">
<td>4</td>
<td>Verify  </td>
<td>Server successfully retrieve correct Recipient Context and decrypts the message: OSCORE verification succeeds</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Check</td>
<td><p>Server parses the request and continues the CoAP processing; expected: CoAP GET request, including:</p>
<ul>
<li>Uri-Path : /oscore/hello/1</li>
</ul></td>
</tr>
<tr class="even">
<td>6</td>
<td>Verify</td>
<td>Server displays the received packet</td>
</tr>
<tr class="odd">
<td>7</td>
<td>Check</td>
<td><p>Server serialize the response correctly, which is: 2.04 Changed Response with:</p>
<ul>
<li>Object-Security option: kid = 0x01</li>
<li>Payload: ciphertext including:
<ul>
<li>Code: 2.05 Content Response</li>
<li>Content-Format = 0 (text/plain)</li>
<li>Payload = “Hello World!”</li>
</ul></li>
</ul></td>
</tr>
<tr class="even">
<td>8</td>
<td>Verify</td>
<td>Server displays the sent packet</td>
</tr>
</tbody>
</table>
<h4 id="test-2a">4.1.3. Identifier: TEST_2a</h4>
<p><strong>Objective</strong> : Perform an OSCORE Group transaction, where the client receive a Recipient Id that it does not have in memory, and derives the Recipient Context for it. (Client side)</p>
<p><strong>Configuration</strong> :</p>
<p><em>client security context</em>: <a href="#client-sec">Security Context A</a>, with:</p>
<ul>
<li>Sequence number received not in client’s replay window</li>
</ul>
<p><strong>Test Sequence</strong></p>
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 14%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Stimulus</td>
<td><p>The client is requested to send a CoAP GET request protected with OSCORE, including:</p>
<ul>
<li>Object-Security option</li>
<li>Uri-Path : /oscore/hello/1</li>
</ul></td>
</tr>
<tr class="even">
<td>2</td>
<td>Check</td>
<td><p>Client serializes the request, which is a POST request, with:</p>
<ul>
<li>Object-Security option</li>
<li>Payload: ciphertext including: * Code: GET * Uri-Path : /oscore/hello/1</li>
</ul></td>
</tr>
<tr class="odd">
<td>3</td>
<td>Verify</td>
<td>Client displays the sent packet</td>
</tr>
<tr class="even">
<td>4</td>
<td>Check</td>
<td><p>Client parses the response; expected: 2.04 Changed Response with:</p>
<ul>
<li>Object-Security option: kid = 0x03</li>
<li>Payload</li>
</ul></td>
</tr>
<tr class="odd">
<td><p>5</p>
<p> </p></td>
<td>Verify  </td>
<td>Client successfully derives a new Recipient Context from received Recipient Id = 0x03 ; Client decrypts the message: OSCORE verification succeeds</td>
</tr>
<tr class="even">
<td>6</td>
<td>Check</td>
<td><p>Client parses the decrypted response and continues the CoAP processing; expected 2.05 Content Response with:</p>
<ul>
<li>Content-Format = 0 (text/plain)</li>
<li>Payload = “Hello World!”</li>
</ul></td>
</tr>
<tr class="odd">
<td>7</td>
<td>Verify</td>
<td>Client displays the received packet</td>
</tr>
</tbody>
</table>
<h4 id="test-2b">4.1.4. Identifier: TEST_2b</h4>
<p><strong>Objective</strong> : Perform an OSCORE Group transaction, where the client receive a Recipient Id that it does not have in memory, and derives the Recipient Context for it. (Server side)</p>
<p><strong>Configuration</strong> :</p>
<p><em>server security context</em>: <a href="#server-sec">Security Context C</a>, with:</p>
<ul>
<li>Sequence number received not in server’s replay window</li>
</ul>
<p><em>server resources</em>:</p>
<ul>
<li>/oscore/hello/1 : protected resource, authorized method: GET, returns the string “Hello World!” with content-format 0 (text/plain)</li>
</ul>
<p><strong>Test Sequence</strong></p>
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 14%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Stimulus</td>
<td><p>The client is requested to send a CoAP GET request protected with OSCORE, including:</p>
<ul>
<li>Object-Security option</li>
<li>Uri-Path = /oscore/hello/1</li>
</ul></td>
</tr>
<tr class="even">
<td>2</td>
<td>Verify</td>
<td>Server displays the received packet</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Check</td>
<td><p>Server parses the request; expected: 0.02 POST with:</p>
<ul>
<li>Object-Security option</li>
<li>Payload</li>
</ul></td>
</tr>
<tr class="even">
<td>4</td>
<td>Verify  </td>
<td>Server successfully retrieve correct Recipient Context and decrypts the message: OSCORE verification succeeds</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Check</td>
<td><p>Server parses the request and continues the CoAP processing; expected: CoAP GET request, including:</p>
<ul>
<li>Uri-Path : /oscore/hello/1</li>
</ul></td>
</tr>
<tr class="even">
<td>6</td>
<td>Verify</td>
<td>Server displays the received packet</td>
</tr>
<tr class="odd">
<td>7</td>
<td>Check</td>
<td><p>Server serialize the response correctly, which is: 2.04 Changed Response with:</p>
<ul>
<li>Object-Security option: kid = 0x01</li>
<li>Payload: ciphertext including:
<ul>
<li>Code: 2.05 Content Response</li>
<li>Content-Format = 0 (text/plain)</li>
<li>Payload = “Hello World!”</li>
</ul></li>
</ul></td>
</tr>
<tr class="even">
<td>8</td>
<td>Verify</td>
<td>Server displays the sent packet</td>
</tr>
</tbody>
</table>
