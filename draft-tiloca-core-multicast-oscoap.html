<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Secure group communication for CoAP</title>

  <style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    padding: 0 1em;
    z-index: 1;
  }
  #rfc\.toc {
    top: 16px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-left: 1.5em;
    padding-right: 29em;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 2.5em auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc, ul.toc ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Terminology"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Assumptions and requirements"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Support for multicast communication"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Binding between requests and responses"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Security material"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Message exchange and processing"/>
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Step 1 - Transmission of multicast request messages"/>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Step 2 - Reception and processing of multicast request messages"/>
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Step 3 - Transmission of unicast response messages"/>
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 Step 4 - Processing of unicast response messages on sender nodes"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgments"/>
<link href="#rfc.references" rel="Chapter" title="8 References"/>
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Appendix"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Tiloca, M." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-tiloca-core-multicast-oscoap-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2016-9-13" />
  <meta name="dct.abstract" content="This document describes how to enable secure communication in a group of devices that exchange (multicast) CoAP messages." />
  <meta name="description" content="This document describes how to enable secure communication in a group of devices that exchange (multicast) CoAP messages." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">CoRE Working Group</td>
  <td class="right">M. Tiloca</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">SICS</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">September 13, 2016</td>
</tr>
<tr>
  <td class="left">Expires: March 17, 2017</td>
  <td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Secure group communication for CoAP<br />
  <span class="filename">draft-tiloca-core-multicast-oscoap-latest</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document describes how to enable secure communication in a group of devices that exchange (multicast) CoAP messages.</p>
<p>The proposed approach relies on Object Security for CoAP (OSCOAP) <a href="#I-D.selander-ace-object-security">[I-D.selander-ace-object-security]</a>, with reference to the "one request - one response" model. No extensions or changes to OSCOAP are required.</p>
<p>Furthermore, the proposed approach provides source authentication of group messages, by means of digital signatures produced through asymmetric private keys and embedded in the secure messages.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 17, 2017.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2016 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Terminology</a></li>
</ul><li>2.   <a href="#rfc.section.2">Assumptions and requirements</a></li>
<li>3.   <a href="#rfc.section.3">Support for multicast communication</a></li>
<li>4.   <a href="#rfc.section.4">Binding between requests and responses</a></li>
<li>5.   <a href="#rfc.section.5">Security material</a></li>
<li>6.   <a href="#rfc.section.6">Message exchange and processing</a></li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Step 1 - Transmission of multicast request messages</a></li>
<li>6.2.   <a href="#rfc.section.6.2">Step 2 - Reception and processing of multicast request messages</a></li>
<li>6.3.   <a href="#rfc.section.6.3">Step 3 - Transmission of unicast response messages</a></li>
<li>6.4.   <a href="#rfc.section.6.4">Step 4 - Processing of unicast response messages on sender nodes</a></li>
</ul><li>7.   <a href="#rfc.section.7">Acknowledgments</a></li>
<li>8.   <a href="#rfc.references">References</a></li>
<ul><li>8.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Appendix</a></li>
<li><a href="#rfc.authors">Author's Address</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a></h1>
<p id="rfc.section.1.p.1">Insert introduction here.</p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#terminology" id="terminology">Terminology</a></h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>. These words may also appear in this document in lowercase, absent their normative meanings.</p>
<p id="rfc.section.1.1.p.2">Readers are expected to be familiar with the terms and concepts described in <a href="#RFC7252">[RFC7252]</a> and <a href="#RFC7641">[RFC7641]</a>.</p>
<p id="rfc.section.1.1.p.3">Terminology for constrained environments, such as "constrained device", "constrained-node network", is defined in <a href="#RFC7228">[RFC7228]</a>.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#assumptions-and-requirements" id="assumptions-and-requirements">Assumptions and requirements</a></h1>
<p id="rfc.section.2.p.1">A node N joins a group G by explicitly interacting with a responsible Group Manager. Upon joining a group, a node receives a unique node ID IDN with respect to a certain context, which is associated to the group G and shared among all its members. These pieces of information are provided by the Group Manager through out-of-band means or other pre-established secure channels (further details are out of scope).</p>
<p id="rfc.section.2.p.2">Node IDs are necessary in order to identify a given node with no commitment to any protocol-relevant identifiers as IP addresses. The Group Manager generates and manages node IDs in order to ensure their uniqueness within a same multicast group. That is, there cannot be multiple nodes that belong to the same group and are associated to a same node ID.</p>
<p id="rfc.section.2.p.3">On the other hand, the group context includes, among other security attributes:</p>
<p/>

<ol>
  <li>a symmetric group key KG;</li>
  <li>a unique context identifier IDGC.</li>
</ol>
<p id="rfc.section.2.p.5">In particular, two distinct group contexts must be associated with different group context identifiers. Since different groups can be managed by different Group Managers, a possible way to ensure uniqueness of group context identifiers is to consider the format IDGC = {IDG || IPGM}, where i) IDG is the group identifier of group G, and is unique in the pool of groups including G and managed by that Group Manager; ii) and IPGM is the IP address of the Group Manager. Possible alternative ways to ensure uniqueness of group context identifiers are out of the scope of this document.</p>
<p id="rfc.section.2.p.6">In order to verify digital signatures of secure messages and ensure their source authenticity, every node in the group is supposed to be pre-provisioned with the necessary public keys associated to message originators, or to get such keys from dedicated entities when it becomes necessary.</p>
<p id="rfc.section.2.p.7">A group member can behave as sender node and/or listener node. As a sender node, it can transmit multicast request messages to the group. As a listener node, it receives multicast request messages from a sender node, and possibly replies by transmitting unicast response messages. Upon joining the group, nodes are not required to know how many and what nodes are active in the group.</p>
<p id="rfc.section.2.p.8">We assume that there are no internal adversaries in the multicast group, i.e. group members are not compromised and are not interested in inspecting and/or tampering with messages sent to / received from other members in the group. Establishment, revocation and renewal of the group context and key material is out of the scope of this document.</p>
<p id="rfc.section.2.p.9">According to the multicast CoAP specification <a href="#RFC7252">[RFC7252]</a>, any possible proxy entity is supposed to know about the sender nodes in the group and to not perform aggregation of response messages. Also, every sender node expects and is able to handle multiple unicast response messages associated to a same multicast request message.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#multicast-communication" id="multicast-communication">Support for multicast communication</a></h1>
<p id="rfc.section.3.p.1">OSCOAP messages exchanged in a group G convey a COSE object whose header includes also:</p>
<p/>

<ol>
  <li>The group context identifier IDGC as "kid" parameter. The most significant bit of IDGC is conventionally set to '1', in order to recognize it as a group context identifier (rather than a unicast context identifier), and to enable the correct parsing of the rest of the COSE object.</li>
  <li>The ID of the sender node, if the OSCOAP message is a multicast request message.</li>
  <li>The ID of the listener node, if the OSCOAP message is a unicast response to a multicast request.</li>
  <li>The Group transaction identifier (GTid), if the OSCOAP message is a unicast response to a multicast request. The GTid is defined as {IDGC , IDS , SN}, where IDS is the ID of the sender node that sent the associated multicast request message, and SN is the write sequence number considered by the sender node when securing and transmitting that request message.</li>
</ol>
<p id="rfc.section.3.p.3">Even in the presence of an intermediary proxy, this makes it possible:</p>
<p/>

<ol>
  <li>on the listener side, to understand which is the specific sender node originating a multicast request message, so decoupling message security and IP addressing;</li>
  <li>on the sender node, to understand which is the specific listener node originating a unicast response message as a reply to a multicast request message, so decoupling message security and IP addressing;</li>
  <li>possibly adopt DTLS to protect hop-by-hop communication between a sender node and a proxy (and vice versa), and between a proxy and a listener node (and vice versa), together with the adoption of secure group communication based on OSCOAP.</li>
</ol>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#req-resp-binding" id="req-resp-binding">Binding between requests and responses</a></h1>
<p id="rfc.section.4.p.1">The mapping between a unicast response message and the associated multicast request message relies on the same principle adopted in OSCOAP <a href="#I-D.selander-ace-object-security">[I-D.selander-ace-object-security]</a>. That is, it is based on the Group Transaction Identifier (GTid), included by listener nodes in the COSE object conveyed in their own unicast response message to a multicast request message.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#sec-material" id="sec-material">Security material</a></h1>
<p id="rfc.section.5.p.1">Each node maintains data structures named read/write group communication states. In particular, each node N in a group G stores:</p>
<p/>

<ol>
  <li>a single write group communication state, considered to secure outgoing multicast request messages and outgoing unicast response messages to received multicast requests;</li>
  <li>a read group communication state for each different node that originated i) a received multicast request message; or ii) a unicast response message to a multicast request previously sent by node N itself. Read group communication states are considered to process such incoming secure messages.</li>
</ol>
<p id="rfc.section.5.p.3">Once it has fully joined a group G, a node N creates a write communication state where it stores:</p>
<p/>

<ol>
  <li>a write sequence number SNWN initialized to 0</li>
  <li>a node key KN as KN = HKDF_Expand(KG , IDN || "Key" || Key_lenght)</li>
  <li>a node initialization vector IVN as IVN = HKDF_Expand(IVG , IDN || "IV" || IV_lenght)</li>
  <li>its own asymmetric private key K-N</li>
</ol>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#coap-headers-and-options" id="coap-headers-and-options">Message exchange and processing</a></h1>
<p id="rfc.section.6.p.1">TODO.</p>
<h1 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> <a href="#step-1-transmission-of-multicast-request-messages" id="step-1-transmission-of-multicast-request-messages">Step 1 - Transmission of multicast request messages</a></h1>
<p id="rfc.section.6.1.p.1">A sender node S refers to its own write group communication state and proceeds as follows.</p>
<p id="rfc.section.6.1.p.2">First, node S produces a signature X of the "Plaintext" and "Additional authenticated data" defined in <a href="#I-D.selander-ace-object-security">[I-D.selander-ace-object-security]</a>, by means of its own asymmetric private key K-S.</p>
<p id="rfc.section.6.1.p.3">Second, node S considers its node key KS and its node initialization vector IVS to protect the outgoing multicast request message. To this end, it produces a secure OSCOAP message <a href="#I-D.selander-ace-object-security">[I-D.selander-ace-object-security]</a>, computing the "Cipher text" from the "Plaintext", the "Additional authenticated data", and the signature X. In particular, node S considers the write sequence number SNWS from its own write group communication state to generate a unique IV for the AEAD.</p>
<p id="rfc.section.6.1.p.4">Finally, node S increments the value of SNWS by 1 and transmits the multicast request message to the group G.</p>
<h1 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> <a href="#step-2-reception-and-processing-of-multicast-request-messages" id="step-2-reception-and-processing-of-multicast-request-messages">Step 2 - Reception and processing of multicast request messages</a></h1>
<p id="rfc.section.6.2.p.1">A listener node L processeses a multicast request message as such, because of the multicast IP destination address specified in the message IP header. If the multicast request message has the most significant bit of the "kid" parameter in the COSE object's header set to 0, node L discards the message as invalid.</p>
<p id="rfc.section.6.2.p.2">Otherwise, node L retrieves the group context identifier IDGC, the sender identifier IDS, and the write sequence number SNWS, from the COSE object's header.</p>
<p id="rfc.section.6.2.p.3">If this is the very first multicast request message received from that sender node (i.e. node L is not maintaining a read group communication state associated to node S), then node L:</p>
<p><a href="#I-D.selander-ace-object-security">[I-D.selander-ace-object-security]</a> derives the sender node key KS = HKDF_Expand(KG , IDS || "Key" || Key_lenght) and the sender node initialization vector IVS = HKDF_Expand(IVG , IDS || "IV" || IV_lenght) associated to node S;</p>
<p/>

<ol>
  <li>creates a read group communication state associated to node S, where it stores KS, IVS, SNWS, and node S' public key K+S.</li>
</ol>
<p id="rfc.section.6.2.p.6">Then, node L considers the sender node key KS, the sender node initialization vector IVS, and the write sequence number SNWS to unsecure the received multicast request message, according to the OSCOAP procedure described in <a href="#I-D.selander-ace-object-security">[I-D.selander-ace-object-security]</a>. After that, it verifies the signature X conveyed in the COSE object, by means of sender S' public key K+S.</p>
<p id="rfc.section.6.2.p.7">If the multicast request message is successfully decrypted and verified, node L updates the sequence number stored in the considered read group communication state, according to the adopted anti-replay policies.</p>
<h1 id="rfc.section.6.3"><a href="#rfc.section.6.3">6.3.</a> <a href="#step-3-transmission-of-unicast-response-messages" id="step-3-transmission-of-unicast-response-messages">Step 3 - Transmission of unicast response messages</a></h1>
<p id="rfc.section.6.3.p.1">In order to reply to a multicast request message sent by node S, the listener node L refers to its own write group communication state and builds a secure unicast response message as follows.</p>
<p id="rfc.section.6.3.p.2">First, node L produces a signature Y of the "Plaintext" and "Additional authenticated data" defined in <a href="#I-D.selander-ace-object-security">[I-D.selander-ace-object-security]</a>, by means of its own asymmetric private key K-L.</p>
<p id="rfc.section.6.3.p.3">Second, node L considers its node key KL and its node initialization vector IVL to protect the outgoing unicast response message. To this end, it produces a secure OSCOAP message <a href="#I-D.selander-ace-object-security">[I-D.selander-ace-object-security]</a>, computing the "Cipher text" from the "Plaintext", the "Additional authenticated data", and the signature Y. In particular, node L considers the write sequence number SNWL from its own write group communication state to generate a unique IV for the AEAD.</p>
<p id="rfc.section.6.3.p.4">Finally, node L increments the value of SNWL by 1 and transmits the unicast response message to the sender node S.</p>
<h1 id="rfc.section.6.4"><a href="#rfc.section.6.4">6.4.</a> <a href="#step-4-processing-of-unicast-response-messages-on-sender-nodes" id="step-4-processing-of-unicast-response-messages-on-sender-nodes">Step 4 - Processing of unicast response messages on sender nodes</a></h1>
<p id="rfc.section.6.4.p.1">A sender node S processes a unicast response message to one of its own previously sent multicast request messages as follows.</p>
<p id="rfc.section.6.4.p.2">Node S retrieves the group context identifier IDGC and the write sequence number SNWL, from the COSE object's header. In particular, IDGC is retrieved from the group transaction identifier GTid.</p>
<p id="rfc.section.6.4.p.3">If this is the very first unicast response message received from node L as a reply to one of S' multicast request messages (i.e. node S is not maintaining a read group communication state associated to node L), then node S:</p>
<p/>

<ol>
  <li>derives the node key KL = HKDF_Expand(KG , IDL || "Key" || Key_lenght) and the node initialization vector IVL = HKDF_Expand(IVG , IDL || "IV" || IV_lenght) associated to node L.</li>
  <li>creates a read group communication state associated to node L, where it stores KL, IVL, SNWL, and node L's public key K+L.</li>
</ol>
<p id="rfc.section.6.4.p.5">Then, node S considers the listener node key KL, the listener node initialization vector IVL, and the write sequence number SNWL to unsecure the received unicast response message, according to the OSCOAP procedure described in <a href="#I-D.selander-ace-object-security">[I-D.selander-ace-object-security]</a>. After that, it verifies the signature Y conveyed in the COSE object, by means of listener L's public key K+L.</p>
<p id="rfc.section.6.4.p.6">If the unicast response message is successfully decrypted and verified, node S updates the sequence number stored in the considered read group communication state, according to the adopted anti-replay policies.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.7.p.1">TODO.</p>
<h1 id="rfc.references"><a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7252">[RFC7252]</b>
      </td>
      <td class="top"><a>Shelby, Z.</a>, <a>Hartke, K.</a> and <a>C. Bormann</a>, "<a href="http://tools.ietf.org/html/rfc7252">The Constrained Application Protocol (CoAP)</a>", RFC 7252, DOI 10.17487/RFC7252, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7641">[RFC7641]</b>
      </td>
      <td class="top"><a>Hartke, K.</a>, "<a href="http://tools.ietf.org/html/rfc7641">Observing Resources in the Constrained Application Protocol (CoAP)</a>", RFC 7641, DOI 10.17487/RFC7641, September 2015.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.selander-ace-object-security">[I-D.selander-ace-object-security]</b>
      </td>
      <td class="top"><a>Selander, G.</a>, <a>Mattsson, J.</a>, <a>Palombini, F.</a> and <a>L. Seitz</a>, "<a href="http://tools.ietf.org/html/draft-selander-ace-object-security-05">Object Security of CoAP (OSCOAP)</a>", Internet-Draft draft-selander-ace-object-security-05, July 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7228">[RFC7228]</b>
      </td>
      <td class="top"><a>Bormann, C.</a>, <a>Ersue, M.</a> and <a>A. Keranen</a>, "<a href="http://tools.ietf.org/html/rfc7228">Terminology for Constrained-Node Networks</a>", RFC 7228, DOI 10.17487/RFC7228, May 2014.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#appendix-a" id="appendix-a">Appendix</a></h1>
<p id="rfc.section.A.p.1">TODO.</p>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Author's Address</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Marco Tiloca</span> 
	  <span class="n hidden">
		<span class="family-name">Tiloca</span>
	  </span>
	</span>
	<span class="org vcardline">SICS</span>
	<span class="adr">
	  <span class="vcardline">TBD</span>

	  <span class="vcardline">
		<span class="locality">Kista</span>,  
		<span class="region"></span>
		<span class="code">TBD</span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:marco@sisc.se">marco@sisc.se</a></span>

  </address>
</div>

  <div class="github-fork-ribbon-wrapper"><div class="github-fork-ribbon"><a href="https://github.com/EricssonResearch/Multicast-OSCOAP">Fork me on GitHub</a></div></div>
</body>
</html>
